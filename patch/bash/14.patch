--- bash-5.0/locale.c	2021-12-01 00:23:40.000000000 +0800
+++ bash-5.0.mod/locale.c	2025-08-12 04:54:05.898144951 +0800
@@ -91,7 +91,7 @@
   locale_mb_cur_max = MB_CUR_MAX;
   locale_utf8locale = locale_isutf8 (default_locale);
 #if defined (HANDLE_MULTIBYTE)
-  locale_shiftstates = mblen ((char *)NULL, 0);
+  locale_shiftstates = mbrlen ((char *)NULL, 0, NULL);
 #else
   locale_shiftstates = 0;
 #endif
@@ -117,7 +117,7 @@
       locale_utf8locale = locale_isutf8 (lc_all);
 
 #    if defined (HANDLE_MULTIBYTE)
-      locale_shiftstates = mblen ((char *)NULL, 0);
+      locale_shiftstates = mbrlen ((char *)NULL, 0, NULL);
 #    else
       locale_shiftstates = 0;
 #    endif
@@ -226,7 +226,7 @@
       if (*lc_all && x)
 	locale_utf8locale = locale_isutf8 (lc_all);
 #  if defined (HANDLE_MULTIBYTE)
-      locale_shiftstates = mblen ((char *)NULL, 0);
+      locale_shiftstates = mbrlen ((char *)NULL, 0, NULL);
 #  else
       locale_shiftstates = 0;
 #  endif
@@ -250,7 +250,7 @@
 	  if (x)
 	    locale_utf8locale = locale_isutf8 (x);
 #if defined (HANDLE_MULTIBYTE)
-	  locale_shiftstates = mblen ((char *)NULL, 0);
+	  locale_shiftstates = mbrlen ((char *)NULL, 0, NULL);
 #else
 	  locale_shiftstates = 0;
 #endif
@@ -391,7 +391,7 @@
   if (x)
     locale_utf8locale = locale_isutf8 (x);
 #  if defined (HANDLE_MULTIBYTE)
-  locale_shiftstates = mblen ((char *)NULL, 0);
+  locale_shiftstates = mbrlen ((char *)NULL, 0, NULL);
 #  else
   locale_shiftstates = 0;
 #  endif
